doctype html
html
  head
    title= title
    link(rel='stylesheet', href='/stylesheets/style.css')
    script(src="http://code.jquery.com/jquery-1.12.0.min.js")
    script(src="http://code.highcharts.com/highcharts.js")
    script(src="http://code.highcharts.com/highcharts-more.js")
  body
    script= dd1
    script= series
    block content
    div(id='container' style={width:'100%',height:'600px'})
    script(type="text/javascript").
     $(function () { 
      $('#container').highcharts({
        chart: {
            type: 'gauge',
            animation: { duration: 5000},
            events : {
                      load : function() {
                              var series = this.series;
                              setInterval(function(){
                                          var xhttp = new XMLHttpRequest();
                                          xhttp.onreadystatechange = function() {
                                               if (xhttp.readyState == XMLHttpRequest.DONE ) {
                                                   if(xhttp.status == 200){
                                                        var data = JSON.parse(xhttp.responseText);
                                                        var date = new Date(data.date).getTime();
                                                        series[0].addPoint([date,data.data.sonde1],true,true);
                                                        series[1].addPoint([date,data.data.sonde2],true,true);
                                                        series[2].addPoint([date,data.data.sonde3],true,true);
                                                        series[3].addPoint([date,data.data.sonde4],true,true);
                                                   }
                                                   else if(xhttp.status == 400) {
                                                        alert('There was an error 400')
                                                   }
                                                   else {
                                                        alert('something else other than 200 was returned')
                                                   }
                                                }
                                         };
                                  xhttp.open("GET", "sondes", true);
                                  xhttp.send();
                              },5000);
                            }
                     }
        },
        title: {
            text: 'Sondes de température'
        },
        yAxis: {
            title: {
                text: 'Température (°C)'
            }
        },
        xAxis: {
            type:'datetime',
            tickInterval: 60000,
            title: {
                text: 'Temps'
            }
        },
        series: series
      });
     });
